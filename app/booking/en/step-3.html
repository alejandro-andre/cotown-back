<!DOCTYPE html>
<html lang="es">

<head>
  [% include 'en/includes/head.html' %]
</head>

<body>
  <div class="tabs-container">

    [% include 'en/includes/header.html' %]

    <div class="main-booking">
      <div class="main-contain">
        <div class="panel-container pure-g">

          <div class="left tab3 pure-u-1 pure-u-lg-3-5">

            <h2>Reserva tu habitación</h2>

            [% if data.logged %]

            <form id="book-form" action="/booking/4" method="post">
              <fieldset>
                <div class="logged-booking pure-g">

                  <h3 class="pure-u-1">Hola [[data.customer.Name]]</h3>
                  <p class="pure-u-1">Completa los siguientes datos para formalizar tu reserva.</p>

                  <div class="pure-u-1">
                    <div class="campo">
                      <label class="label">Motivo de la estancia</label>
                      <select name="Reason_id" required>
                        <option value="">Selecciona motivo</option>
                        [% for c in data.reasons %]
                        <option value="[[c.id]]">[[c.Name]]</option>
                        [% endfor %]
                       </select>
                    </div>
                  </div>

                  <input type="hidden" name="book_action" value="book">

                  <section class="next">
                    <button type="submit" class="btn-secondary">Confirmar y reservar</button>
                  </section>

                </div>

              </fieldset>
            </form>

            <form id="logout-form" action="/booking/4" method="post" style="margin-top: -40px;">
              <fieldset>
                <div class="pure-g">
                  <section class="next">
                    <input type="hidden" name="book_action" value="logout">
                    <button type="submit" class="btn-primary">No soy [[data.customer.Name]]</button>
                  </section>
                </div>
              </fieldset>
            </form>

            [% else %]

            <form id="login-form" action="/booking/4" method="post">
              <fieldset>
                <div class="login pure-g">

                  <h3 class="pure-u-1">Inicia sesión</h3>
                  <p class="pure-u-1">Utiliza tus credenciales para acceder.</p>

                  <div class="pure-u-1">
                      <div class="campo">
                      <label class="label">Email</label>
                      <input class="input" type="email" name="book_user"
                             required placeholder="Tu email">
                    </div>
                  </div>
                  <div class="pure-u-1">
                    <div class="campo psw">
                      <label class="label">Contraseña</label>
                      <input class="input" type="password" name="book_password"
                             required placeholder="Tu contraseña">
                    </div>
                  </div>

                  [% if data.error_login %]
                  <div class="pure-u-1 error-message"><p>[[data.error_login[data.lang]]]</p></div>
                  [% endif %]

                  <p class="advise">
                    Si ha olvidado su contraseña puedes restablecerla utilizando nuestro
                    <a href="https://core.cotown.com/auth/realms/airflows/login-actions/reset-credentials?client_id=airflows-private">formulario de recuperación de contraseña</a>.
                  </p>

                  <input type="hidden" name="book_action" value="login">

                  <section class="next">
                    <button type="submit" class="btn-secondary">Iniciar sesión</button>
                  </section>

                </div>
              </fieldset>
            </form>

            <form id="register-form" action="/booking/4" method="post">
              <fieldset>
                <div class="registry pure-g">

                  <h3 class="pure-u-1 record">O regístrate</h3>
                  <p class="pure-u-1">Necesitaremos tus datos para formalizar la reserva.</p>

                  <div class="pure-u-1">
                    <div class="campo">
                      <label class="label">Nombre y apellidos</label>
                      <input class="input" type="name" name="Name" value="[[data.customer.Name]]"
                             required placeholder="Tú nombre y apellidos">
                    </div>
                  </div>

                  <div class="pure-u-1">
                    <div class="campo">
                      <label class="label">Email</label>
                      <input class="input" type="email" name="Email" value="[[data.customer.Email]]"
                             required placeholder="Tu email">
                    </div>
                  </div>

                  <div class="pure-u-1-3">
                    <div class="campo">
                      <label class="label">Prefijo telefónico</label>
                      <select name="Prefix" required>
                        <option value="">Selecciona prefijo</option>
                        [% for c in data.countries %]
                        [% if c.Prefix != null %]
                        <option value="[[c.Prefix]]"[% if c.Prefix==data.customer.Prefix %] selected[% endif %]>[[c.Name]] ([[c.Prefix]])</option>
                        [% endif %]
                        [% endfor %]
                      </select>
                    </div>
                  </div>

                  <div class="pure-u-2-3">
                    <div class="campo">
                      <label class="label">Número de teléfono</label>
                      <input class="input" type="name" name="Phone"
                             required value="[[data.customer.Phone]]" placeholder="Tu nº de teléfono">
                    </div>
                  </div>

                  <div class="pure-u-1 pure-u-lg-1-3">
                    <div class="campo">
                      <div class="dates">
                        <label class="label">Fecha de nacimiento</label>
                        <input type="date" name="Birth_date"
                               required value="[[data.customer.Birth_date]]" placeholder="Fecha dd/mm/aaaa"/>
                      </div>
                    </div>
                  </div>

                  <div class="pure-u-1 pure-u-lg-1-3">
                    <div class="campo">
                      <label class="label">Nacionalidad</label>
                      <select name="Nationality_id" required>
                        <option value="">Selecciona país</option>
                        [% for c in data.countries %]
                        <option value="[[c.id]]"[% if c.id==data.customer.Nationality_id %] selected[% endif %]>[[c.Name]]</option>
                        [% endfor %]
                      </select>
                    </div>
                  </div>

                  <div class="pure-u-1 pure-u-lg-1-3">
                    <div class="campo">
                      <label class="label">Género</label>
                      <select name="Gender_id" required>
                        <option value="">Selecciona género</option>
                        [% for c in data.genders %]
                        <!-- [[c.id]] - [[data.customer.Gender_id]] - [[c.id==data.customer.Gender_id]]-->
                        <option item="[[data.customer.Gender_id]]" value="[[c.id]]"[% if c.id==data.customer.Gender_id %] selected[% endif %]>[[c.Name]]</option>
                        [% endfor %]
                      </select>
                    </div>
                  </div>

                  [% if data.error_register %]
                  <div class="pure-u-1 error-message"><p>[[data.error_register[data.lang]]]</p></div>
                  [% endif %]

                  <input type="hidden" name="book_action" value="register">

                  <section class="next">
                    <button type="submit" class="btn-secondary">Registrarse</button>
                  </section>

                </div>
                [% endif %]

              </fieldset>
            </form>

          </div>

          <div class="right tab3 pure-u-1 pure-u-lg-2-5">
            <div class="resume">
              <h3>Resumen de reserva</h3>
              <p>Ubicación</p>
              <div class="resume-edit">
                <h4>[[data.city.Name]]</h4>
                <!--
                <button class="btn-text">
                  <em class="icon-write"></em>
                  <p>Editar</p>
                </button>
                -->
              </div>

              <div class="dates">
                <div class="in">
                  <p>ENTRADA</p>
                  <h4>[[data.date_from]]</h4>
                </div>
                <div class="out">
                  <p>SALIDA</p>
                  <h4>[[data.date_to]]</h4>
                </div>
              </div>

              <div class="type-resume">
                <h4>[[data.summary.Place_type_name]]</h4>
                <p>[[data.summary.Building_name]]</p>                                     
              </div>

              <div class="breakdown">
                <h4>Desglose del precio</h4>
                <div class="prices">
                  <p>Booking fee</p>
                  <p>[[data.summary.Booking_fee]]€</p>
                </div>
                <div class="prices">
                  <p>Garantía</p>
                  <p>
                    [% if data.summary.Deposit < data.summary.Rent + data.summary.Services %]
                    [[data.summary.Rent + data.summary.Services]]
                    [% else %]
                    [[data.summary.Deposit]]
                    [% endif %]
                  €</p>
                </div>
                [% if data.summary.Final_cleaning %]
                <div class="prices">
                  <p>Limpieza final</p>
                  <p>[[data.summary.Final_cleaning]]€</p>
                </div>
                [% endif %]
                <div class="total">
                  <p>Total pago único</p>
                  <p>
                    [% if data.summary.Deposit < data.summary.Rent + data.summary.Services %]
                    [[data.summary.Booking_fee + data.summary.Rent + data.summary.Services]]
                    [% else %]
                    [[data.summary.Booking_fee + data.summary.Deposit]]
                    [% endif %]
                  </p>
                </div>
              </div>

              <div class="renta">
                <h3>Renta media mensual</h3>
                <h3>[[data.summary.Rent + data.summary.Services]]€ *</h3>
              </div>

              <p class="advise">* Suministros de agua, gas y luz incluidos en el importe mensual hasta [[data.summary.Limit]]€/mes.</p>

            </div>
          </div>

        </div>
      </div>
    </div>

  </div>

</body>

</html>
